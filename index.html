<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genetic Rogue Ver.6 - Hack & Slash</title>
    <style>
        :root {
            --bg-color: #050505; --panel-bg: #111; --text-color: #ddd;
            --accent-color: #00ff9d; --danger-color: #ff4d4d;
            --tier1: #bdc3c7; --tier2: #3498db; --tier3: #9b59b6; --tier4: #e74c3c; --tier5: #f1c40f;
            --rar-common: #ccc; --rar-rare: #00ff9d; --rar-legend: #f1c40f;
            --log-font: 'Consolas', monospace;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg-color); color: var(--text-color); font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; }
        
        #app { display: grid; grid-template-rows: 50px 1fr 60px; height: 100%; max-width: 1400px; margin: 0 auto; width: 100%; }
        header { background: var(--panel-bg); border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        main { display: grid; grid-template-columns: 350px 1fr; gap: 1px; background: #222; overflow: hidden; }
        @media (max-width: 800px) { main { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; } }

        /* Logs */
        #log-panel { background: var(--bg-color); padding: 10px; overflow-y: auto; font-family: var(--log-font); font-size: 11px; line-height: 1.4; }
        .log-entry { margin-bottom: 2px; padding-left: 5px; border-left: 2px solid #333; }
        .log-combat { color: #888; border-color: #444; }
        .log-dmg { color: #aaa; }
        .log-victory { color: #fff; border-color: var(--accent-color); }
        .log-rare { color: var(--rar-rare); border-color: var(--rar-rare); }
        .log-legend { color: var(--rar-legend); border-color: var(--rar-legend); font-weight: bold; }
        .log-defeat { color: var(--danger-color); border-color: var(--danger-color); }

        /* Party Cards */
        #party-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 8px; padding: 10px; }
        .char-card { background: #1a1a1a; border: 1px solid #333; padding: 8px; border-radius: 4px; font-size: 11px; }
        .char-header { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 2px; }
        .bar-wrap { background: #333; height: 4px; margin: 2px 0; position:relative; }
        .bar-val { height: 100%; transition: width 0.3s; }
        .hp-bar { background: var(--accent-color); }
        .exp-bar { background: #3498db; }
        
        /* Stats & Equip */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 2px; color: #aaa; margin-top: 4px; }
        .stat-bonus { color: var(--accent-color); }
        .equip-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 6px; border-top: 1px solid #333; padding-top: 4px; }
        .equip-slot { background: #111; padding: 3px; border-radius: 2px; color: #666; font-size: 10px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .equip-active { color: #ddd; }
        .rar-2 { color: var(--rar-rare); } .rar-3 { color: var(--rar-legend); } .rar-4, .rar-5 { color: #e74c3c; text-shadow: 0 0 2px #f00; }

        /* Footer & Modals */
        footer { background: var(--panel-bg); border-top: 1px solid #333; display: flex; align-items: center; justify-content: center; gap: 10px; }
        button { background: #333; color: #fff; border: 1px solid #555; padding: 8px 15px; cursor: pointer; border-radius: 3px; }
        button:hover { background: #444; }
        button:disabled { opacity: 0.3; }
        
        .modal-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.85); display: none; z-index: 99; justify-content: center; align-items: center; }
        .modal-box { background: #111; width: 90%; max-width: 900px; max-height: 90vh; border: 1px solid #444; display: flex; flex-direction: column; }
        .modal-body { padding: 15px; overflow-y: auto; }
        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 8px; }
        .list-item { padding: 8px; border: 1px solid #333; cursor: pointer; background: #161616; position: relative; }
        .list-item:hover { border-color: #666; }
        .list-item.selected { border-color: var(--accent-color); background: #002211; }
    </style>
</head>
<body>

<div id="app">
    <header>
        <div>üß¨ Genetic Rogue <span style="color:#666;">Ver.6.0</span></div>
        <div style="font-size:14px;">
            <span style="color:#aaa;">Floor:</span> <span id="floor-display" style="font-weight:bold; font-size:16px;">1</span>
            <span style="color:#666; margin-left:5px;" id="floor-progress">(0/10)</span>
            <span style="margin-left:20px; color:var(--accent-color); font-weight:bold;">Helix: <span id="helix-display">0</span></span>
        </div>
    </header>

    <main>
        <div id="log-panel"><div id="log-list"></div></div>
        <div id="info-panel">
            <div id="party-container"></div>
        </div>
    </main>

    <footer>
        <button id="btn-explore">Êé¢Á¥¢ÈñãÂßã</button>
        <button id="btn-return" disabled>Â∏∞ÈÇÑ</button>
        <span style="width:20px"></span>
        <button id="btn-lab">„É©„Éú</button>
        <button id="btn-inv">Ë£ÖÂÇô</button>
    </footer>
</div>

<!-- Modals -->
<div id="modal-lab" class="modal-overlay">
    <div class="modal-box">
        <div style="padding:10px; border-bottom:1px solid #333; display:flex; justify-content:space-between;">
            <h3>Genetic Lab</h3> <button class="close-modal">Close</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom:10px;">
                <button id="act-breed" disabled>ÈÖçÂêà (50G)</button>
                <button id="act-party" disabled>Á∑®Êàê/Ëß£Èô§</button>
                <button id="act-hire">ÈõáÁî® (30G)</button>
            </div>
            <div id="lab-list" class="grid-list"></div>
        </div>
    </div>
</div>

<div id="modal-inv" class="modal-overlay">
    <div class="modal-box">
        <div style="padding:10px; border-bottom:1px solid #333; display:flex; justify-content:space-between;">
            <h3>Inventory</h3> <button class="close-modal">Close</button>
        </div>
        <div class="modal-body" style="display:flex; gap:20px;">
            <div style="width:200px; border-right:1px solid #333;">
                <div id="equip-char-list"></div>
            </div>
            <div style="flex:1;">
                <div id="inv-list" class="grid-list"></div>
            </div>
        </div>
    </div>
</div>

<!-- Load Data -->
<script src="game_data.js"></script>

<script>
/**
 * Genetic Rogue Ver.6.0
 * - Affix System
 * - Floor System
 * - Transparent Combat Math
 */

// Fallback check
if (typeof JOB_DATA === 'undefined') { alert("Error: game_data.js missing"); throw new Error("Data Missing"); }

const CONFIG = {
    MAX_PARTY: 6,
    BREED_COST: 50, HIRE_COST: 30,
    BASE_STATS: { hp: 50, atk: 5, def: 5, agi: 5, mag: 5, int: 5, luc: 5 },
    TIER_COLORS: { 1:'#bdc3c7', 2:'#3498db', 3:'#9b59b6', 4:'#e74c3c', 5:'#f1c40f' }
};

// --- Item Generator (The Core of Hack & Slash) ---
const LootSystem = {
    generate(floor) {
        // 1. Pick Template based on rarity/floor
        const keys = Object.keys(ITEM_TEMPLATES);
        const tKey = keys[Math.floor(Math.random() * keys.length)];
        const tpl = ITEM_TEMPLATES[tKey];
        
        // 2. Determine Rarity (Floor increases chance)
        let rarity = 1; // 1:Common, 2:Rare, 3:Epic, 4:Legendary, 5:Godly
        const rand = Math.random() + (floor * 0.01); // Boost by floor
        if (rand > 0.98) rarity = 4;
        else if (rand > 0.90) rarity = 3;
        else if (rand > 0.70) rarity = 2;

        if (rarity > 4 && floor > 20) rarity = 5; // Godly check

        // 3. Create Item Instance
        let item = {
            uid: Math.random().toString(36).substr(2),
            name: tpl.name,
            type: tpl.type,
            slot: tpl.slot,
            stats: { ...tpl.base },
            rarity: Math.max(tpl.rar, rarity)
        };

        // 4. Add Affixes
        if (item.rarity >= 2) {
            // Pick Prefix
            const pPool = AFFIX_DATA.prefix.filter(a => a.rar <= item.rarity);
            if (pPool.length > 0) {
                const affix = pPool[Math.floor(Math.random() * pPool.length)];
                item.name = `${affix.name}${item.name}`;
                this.mergeStats(item.stats, affix.stats);
            }
        }
        
        if (item.rarity >= 4) {
            // Pick Title (Suffix or Name replacement)
            const tPool = AFFIX_DATA.titles.filter(a => a.rar <= item.rarity);
            if (tPool.length > 0) {
                const title = tPool[Math.floor(Math.random() * tPool.length)];
                item.name = `${title.name} ${item.name}`; // e.g. "Dragonslayer Sharp Sword"
                this.mergeStats(item.stats, title.stats);
            }
        }

        return item;
    },

    mergeStats(base, add) {
        for (let k in add) {
            base[k] = (base[k] || 0) + add[k];
        }
    }
};

// --- Character Class ---
class Character {
    constructor(jobKey, parents=null) {
        this.id = Math.random().toString(36).substr(2, 9);
        this.jobKey = jobKey;
        this.jobData = JOB_DATA[jobKey];
        this.name = this.genName();
        this.level = 1;
        this.exp = 0;
        this.maxExp = 100;
        this.generation = parents ? Math.max(parents[0].generation, parents[1].generation)+1 : 1;
        
        // Ver.6: Store Objects, not IDs
        this.equipment = { main_hand: null, off_hand: null, head: null, body: null, accessory: null };

        this.baseStats = {};
        for(let k in CONFIG.BASE_STATS) {
            let base = CONFIG.BASE_STATS[k];
            let mod = this.jobData.stats_mod[k] || 1.0;
            if(parents) {
                let pAvg = (parents[0].baseStats[k] + parents[1].baseStats[k]) / 2;
                base = (base + pAvg) / 2;
            }
            this.baseStats[k] = Math.floor(base * mod * (0.9 + Math.random()*0.2));
        }
        this.hp = this.totalStats.hp;
        this.color = CONFIG.TIER_COLORS[this.jobData.tier] || '#fff';
    }

    genName() {
        const pre = ["Neo","Cyber","Iron","Dark","Holy","Nano","Bio","Void"];
        const suf = ["Alpha","Zero","X","V","Soul","Mind"];
        return pre[Math.floor(Math.random()*pre.length)] + suf[Math.floor(Math.random()*suf.length)];
    }

    get totalStats() {
        let s = { ...this.baseStats };
        // Level Growth
        for(let k in s) {
            let growth = (CONFIG.BASE_STATS[k]/10) * (this.jobData.stats_mod[k]||1.0);
            s[k] += Math.floor(growth * (this.level - 1));
        }
        // Equip Bonus
        for(let slot in this.equipment) {
            let item = this.equipment[slot];
            if(item) {
                for(let k in item.stats) {
                    s[k] = (s[k] || 0) + item.stats[k];
                }
            }
        }
        s.hp = Math.floor(s.hp);
        return s;
    }

    // New: Helper to get split stats for UI (Base / Bonus)
    get statDetails() {
        let total = this.totalStats;
        let baseWithLv = { ...this.baseStats };
        for(let k in baseWithLv) {
            let growth = (CONFIG.BASE_STATS[k]/10) * (this.jobData.stats_mod[k]||1.0);
            baseWithLv[k] += Math.floor(growth * (this.level - 1));
        }
        
        let display = {};
        for(let k in total) {
            let bonus = total[k] - (baseWithLv[k] || 0);
            display[k] = { val: total[k], bonus: bonus };
        }
        return display;
    }

    equip(item) {
        if(this.equipment[item.slot]) {
            Game.inventory.push(this.equipment[item.slot]); // Return old
        }
        this.equipment[item.slot] = item;
        this.hp = Math.min(this.hp, this.totalStats.hp); // Cap HP
    }
    
    unequip(slot) {
        if(this.equipment[slot]) {
            Game.inventory.push(this.equipment[slot]);
            this.equipment[slot] = null;
        }
    }

    gainExp(amt) {
        this.exp += Math.floor(amt);
        if(this.exp >= this.maxExp) {
            this.exp -= this.maxExp;
            this.level++;
            this.maxExp = Math.floor(this.maxExp * 1.2);
            this.hp = this.totalStats.hp; // Heal
            return true;
        }
        return false;
    }
}

// --- Game Logic ---
const Game = {
    helix: 100, floor: 1, floorProgress: 0,
    party: [], roster: [], inventory: [],
    exploring: false, timer: null,

    init() {
        ["warrior","mage","thief","priest"].forEach(j => this.roster.push(new Character(j)));
        this.roster.slice(0,3).forEach(c => this.party.push(c));
        // Give starter items
        this.inventory.push(LootSystem.generate(1));
        this.inventory.push(LootSystem.generate(1));
        UI.updateAll();
        UI.log("Genetic Rogue Ver.6.0 Started.");
    },

    explore() {
        if(this.party.length === 0) return alert("Party empty!");
        this.exploring = true;
        UI.toggle(true);
        UI.log(`--- Floor ${this.floor} Start ---`);
        this.timer = setInterval(() => this.tick(), 1000);
    },

    stop() {
        this.exploring = false;
        clearInterval(this.timer);
        this.party.forEach(c => c.hp = c.totalStats.hp);
        UI.toggle(false);
        UI.updateAll();
        UI.log("Returned to base.");
    },

    tick() {
        if(this.party.filter(c=>c.hp>0).length === 0) {
            this.stop();
            UI.log("Party Wipeout...", "defeat");
            this.floor = Math.max(1, this.floor-5);
            this.floorProgress = 0;
            return;
        }
        
        // Floor Progress
        this.floorProgress++;
        if(this.floorProgress >= 10) {
            this.floor++;
            this.floorProgress = 0;
            UI.log(`>>> Reached Floor ${this.floor}! Enemies grew stronger.`, "legend");
        }
        UI.updateHeader();

        Math.random() < 0.65 ? this.combat() : this.event();
        UI.renderParty();
    },

    combat() {
        // Enemy Scaling: (1 + Floor * 0.2) -> 2x stats at Floor 5
        let scale = 1 + (this.floor * 0.2); 
        let tier = Math.min(5, Math.ceil(this.floor / 5));
        
        let cands = ENEMY_DATA.filter(e => e.tier === tier);
        let baseE = cands[Math.floor(Math.random() * cands.length)] || ENEMY_DATA[0];

        let enemy = {
            name: baseE.name,
            hp: Math.floor(baseE.stats.hp * scale),
            atk: Math.floor(baseE.stats.atk * scale),
            def: Math.floor(baseE.stats.def * scale),
            exp: Math.floor(baseE.stats.exp * scale),
            gold: Math.floor(baseE.stats.gold * scale)
        };

        UI.log(`Battle: ${enemy.name} (HP:${enemy.hp})`, "combat");

        this.party.forEach(c => {
            if(c.hp <= 0 || enemy.hp <= 0) return;
            
            // New Transparent Formula: (ATK * Rnd) - (DEF / 2)
            let s = c.totalStats;
            let atkRoll = Math.floor(s.atk * (0.9 + Math.random() * 0.2));
            let defRed = Math.floor(enemy.def / 2);
            let dmg = Math.max(1, atkRoll - defRed);
            
            if(Math.random()*100 < s.luc) { dmg=Math.floor(dmg*1.5); UI.log(`${c.name} Crit!`, "log-dmg"); }
            
            enemy.hp -= dmg;
            UI.log(`> ${c.name} hit (ATK:${atkRoll} vs DEF:${defRed}) -> ${dmg} dmg`, "log-dmg");
        });

        if(enemy.hp <= 0) {
            UI.log(`Victory! +${enemy.gold}G`, "victory");
            this.helix += enemy.gold;
            this.party.forEach(c => c.hp>0 && c.gainExp(enemy.exp) && UI.log(`${c.name} LvUp!`));
            
            // Drop Rate: 30%
            if(Math.random() < 0.3) {
                let item = LootSystem.generate(this.floor);
                this.inventory.push(item);
                let style = item.rarity>=4 ? "log-legend" : (item.rarity>=2 ? "log-rare" : "");
                UI.log(`Drop: [${item.name}]`, style);
            }
        } else {
            let t = this.party[Math.floor(Math.random()*this.party.length)];
            if(t.hp > 0) {
                let s = t.totalStats;
                let atkRoll = Math.floor(enemy.atk * (0.9 + Math.random() * 0.2));
                let defRed = Math.floor(s.def / 2);
                let dmg = Math.max(1, atkRoll - defRed);
                t.hp -= dmg;
                UI.log(`${t.name} took (ATK:${atkRoll} vs DEF:${defRed}) -> ${dmg} dmg`, "defeat");
            }
        }
    },

    event() {
        let g = 10 + (this.floor * 2);
        this.helix += g;
        UI.log(`Salvage: +${g} Helix`);
    },

    breed(id1, id2) {
        if(this.helix < CONFIG.BREED_COST) return;
        let p1 = this.roster.find(c=>c.id===id1);
        let p2 = this.roster.find(c=>c.id===id2);
        let tier = Math.max(p1.jobData.tier, p2.jobData.tier);
        if(Math.random() < 0.3) tier++;
        let pool = Object.keys(JOB_DATA).filter(k=>JOB_DATA[k].tier <= tier);
        let job = pool[Math.floor(Math.random()*pool.length)];
        
        this.helix -= CONFIG.BREED_COST;
        let c = new Character(job, [p1,p2]);
        this.roster.push(c);
        UI.log(`Born: ${c.name} (${c.jobData.name})`);
        UI.updateAll();
    },

    hire() {
        if(this.helix < CONFIG.HIRE_COST) return;
        let pool = Object.keys(JOB_DATA).filter(k=>JOB_DATA[k].tier === 1);
        let job = pool[Math.floor(Math.random()*pool.length)];
        this.helix -= CONFIG.HIRE_COST;
        let c = new Character(job);
        this.roster.push(c);
        UI.log(`Hired: ${c.name}`);
        UI.updateAll();
    }
};

// --- UI ---
const UI = {
    sel: [], equipTarget: null,

    init() {
        document.getElementById('btn-explore').onclick = ()=>Game.explore();
        document.getElementById('btn-return').onclick = ()=>Game.stop();
        document.getElementById('btn-lab').onclick = ()=>this.openModal('modal-lab', this.rendLab);
        document.getElementById('btn-inv').onclick = ()=>this.openModal('modal-inv', this.rendInv);
        document.querySelectorAll('.close-modal').forEach(b=>b.onclick=()=>document.querySelectorAll('.modal-overlay').forEach(m=>m.style.display='none'));

        document.getElementById('act-breed').onclick = () => { if(this.sel.length===2) { Game.breed(this.sel[0], this.sel[1]); this.sel=[]; this.rendLab(); }};
        document.getElementById('act-party').onclick = () => { this.sel.forEach(id => {
            let c = Game.roster.find(x=>x.id===id);
            let idx = Game.party.indexOf(c);
            idx>-1 ? Game.party.splice(idx,1) : (Game.party.length<CONFIG.MAX_PARTY && Game.party.push(c));
        }); this.sel=[]; this.rendLab(); };
        document.getElementById('act-hire').onclick = () => { Game.hire(); this.rendLab(); };

        Game.init();
    },

    updateAll() { this.updateHeader(); this.renderParty(); },
    updateHeader() {
        document.getElementById('helix-display').innerText = Game.helix;
        document.getElementById('floor-display').innerText = Game.floor;
        document.getElementById('floor-progress').innerText = `(${Game.floorProgress}/10)`;
    },
    toggle(on) {
        document.getElementById('btn-explore').disabled = on;
        document.getElementById('btn-return').disabled = !on;
    },
    log(msg, type='') {
        let d = document.getElementById('log-list');
        d.innerHTML += `<div class="log-entry ${type}">${msg}</div>`;
        document.getElementById('log-panel').scrollTop = 99999;
    },
    openModal(id, fn) { this.sel=[]; this.equipTarget=null; document.getElementById(id).style.display='flex'; fn.call(this); },

    renderParty() {
        const d = document.getElementById('party-container');
        d.innerHTML = '';
        Game.party.forEach(c => {
            let s = c.totalStats;
            let dets = c.statDetails; // Get split stats
            let hpP = (c.hp/s.hp)*100;
            let expP = (c.exp/c.maxExp)*100;
            
            // Format Stats: 50 (+10)
            const fmt = (k) => `<span class="${dets[k].bonus>0?'stat-bonus':''}">${dets[k].val}${dets[k].bonus>0 ? '(+'+dets[k].bonus+')':''}</span>`;
            
            // Equip list
            let eqHtml = "";
            for(let slot in c.equipment) {
                let item = c.equipment[slot];
                let cls = item ? `equip-active rar-${item.rarity}` : "";
                eqHtml += `<div class="equip-slot ${cls}">${slot.substr(0,2)}: ${item ? item.name : '-'}</div>`;
            }

            d.innerHTML += `
            <div class="char-card" style="border-left:3px solid ${c.color}">
                <div class="char-header"><span>${c.name}</span> <span style="color:${c.color}">${c.jobData.name}</span></div>
                <div class="bar-wrap"><div class="bar-val hp-bar" style="width:${hpP}%"></div></div>
                <div class="bar-wrap" style="height:2px;"><div class="bar-val exp-bar" style="width:${expP}%"></div></div>
                <div style="font-size:10px; color:#888; text-align:right;">Lv.${c.level} (Exp:${c.exp}/${c.maxExp})</div>
                
                <div class="stat-grid">
                    <span>ATK:${fmt('atk')}</span> <span>DEF:${fmt('def')}</span>
                    <span>MAG:${fmt('mag')}</span> <span>HP:${c.hp}/${s.hp}</span>
                </div>
                <div class="equip-grid">${eqHtml}</div>
            </div>`;
        });
    },

    rendLab() {
        const d = document.getElementById('lab-list'); d.innerHTML = '';
        Game.roster.forEach(c => {
            let inPt = Game.party.includes(c);
            let sel = this.sel.includes(c.id);
            let el = document.createElement('div');
            el.className = `list-item ${sel?'selected':''}`;
            if(inPt) el.style.borderRight = "3px solid var(--accent-color)";
            el.innerHTML = `<div>${c.name}</div><div style="font-size:10px; color:#888;">${c.jobData.name} (T${c.jobData.tier})</div>`;
            el.onclick = () => {
                sel ? this.sel=this.sel.filter(x=>x!==c.id) : this.sel.push(c.id);
                this.rendLab();
                document.getElementById('act-breed').disabled = this.sel.length!==2;
                document.getElementById('act-party').disabled = this.sel.length===0;
            };
            d.appendChild(el);
        });
    },

    rendInv() {
        const cList = document.getElementById('equip-char-list'); cList.innerHTML='';
        Game.party.forEach(c => {
            let el = document.createElement('div');
            el.className = `list-item ${this.equipTarget===c?'selected':''}`;
            el.innerHTML = `<div>${c.name}</div><div style="font-size:10px;">${c.jobData.name}</div>`;
            el.onclick = () => { this.equipTarget=c; this.rendInv(); };
            cList.appendChild(el);
        });

        const iList = document.getElementById('inv-list'); iList.innerHTML='';
        if(!this.equipTarget) { iList.innerHTML="Select Char"; return; }
        
        let c = this.equipTarget;
        // Current Equip
        let eqDiv = document.createElement('div');
        eqDiv.style.borderBottom="1px solid #333"; eqDiv.style.marginBottom="10px";
        for(let slot in c.equipment) {
            let item = c.equipment[slot];
            let info = item ? `<span class="rar-${item.rarity}">${item.name}</span>` : '<span style="color:#444">Empty</span>';
            let btn = item ? `<button style="font-size:9px; margin-left:5px;" onclick="UI.doUnequip('${slot}')">X</button>` : '';
            eqDiv.innerHTML += `<div style="font-size:11px; margin-bottom:2px; color:#aaa;">${slot}: ${info} ${btn}</div>`;
        }
        iList.appendChild(eqDiv);

        // Inventory Items
        if(Game.inventory.length===0) iList.innerHTML+="<div style='color:#666'>No Items</div>";
        Game.inventory.forEach((item, idx) => {
            let el = document.createElement('div');
            el.className = 'list-item';
            let stats = Object.keys(item.stats).map(k=>`${k}:${item.stats[k]}`).join(' ');
            el.innerHTML = `
                <div style="font-weight:bold;" class="rar-${item.rarity}">${item.name}</div>
                <div style="font-size:10px; color:#666;">${item.type} [${item.slot}]</div>
                <div style="font-size:10px; color:var(--accent-color);">${stats}</div>
            `;
            el.onclick = () => {
                c.equip(item);
                Game.inventory.splice(idx, 1);
                this.rendInv(); this.renderParty();
            };
            iList.appendChild(el);
        });
    },

    doUnequip(slot) { this.equipTarget.unequip(slot); this.rendInv(); this.renderParty(); }
};

window.onload = ()=>UI.init();
</script>
</body>
</html>